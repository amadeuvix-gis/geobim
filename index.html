<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3D WebScene Viewer - Modern Dark Responsive</title>

<link rel="stylesheet" href="https://js.arcgis.com/4.34/esri/themes/dark/main.css">
<script src="https://js.arcgis.com/4.34/"></script>

<style>
html, body, #viewDiv {
  height: 100%; margin: 0; padding: 0;
  font-family: "Segoe UI", Arial, sans-serif;
  background-color: #1c1c1c;
}

/* Header */
#header {
  position: absolute; top:0; left:0; right:0;
  height: 60px; background: #111;
  color: #fff; display: flex; justify-content: space-between;
  align-items: center; padding: 0 15px;
  z-index: 130; box-shadow: 0 2px 5px rgba(0,0,0,0.5);
}
#header h1 { margin: 0; font-size: 1.3em; }
#header h2 { margin: 0; font-size: 0.85em; font-weight: normal; color: #aaa; }
#titleBlock { display: flex; flex-direction: column; align-items: flex-start; }

/* Help Button */
#btnHelp {
  background: rgba(255,255,255,0.15);
  border-radius: 50%; width: 38px; height: 38px;
  display: flex; align-items: center; justify-content: center;
  color: #fff; font-size: 1.3em; cursor: pointer;
  transition: all 0.3s ease;
}
#btnHelp:hover { background: #1e90ff; }

/* Floating Buttons */
.floating-btn {
  position: absolute; width: 50px; height: 50px;
  border-radius: 50%; display: flex; align-items: center; justify-content: center;
  background: rgba(250,250,250,0.85); color: #000; cursor: pointer; font-size: 1.4em;
  box-shadow: 0 3px 6px rgba(0,0,0,0.3); transition: all 0.2s ease-in-out;
  z-index: 120;
}
.floating-btn:hover { background: #1e90ff; color: #fff; transform: scale(1.1); }

#btnBookmarks { top: 70px; right: 10px; }
#btnLayers { top: 130px; right: 10px; }
#btnLegend { top: 190px; right: 10px; }
#btnDaylight { top: 250px; right: 10px; }
#btnMeasurement { top: 310px; right: 10px; }
#btnElevation { top: 370px; right: 10px; }

/* Panels */
.side-panel {
  width: 360px; height: 80%;
  background: rgba(25,25,25,0.95);
  position: absolute; top: 70px; right: -380px;
  border-radius: 8px; overflow-y: auto;
  transition: right 0.4s ease-in-out; padding: 15px;
  z-index: 110; opacity: 0; transform: translateX(30px);
}
.side-panel.open { right: 70px; opacity: 1; transform: translateX(0); transition: all 0.4s ease; }

/* Help Panel */
#helpPanel h3 {
  margin-top: 0;
  text-align: center;
  color: #1e90ff;
}
.help-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  background: #2a2a2a;
  margin: 10px 0;
  padding: 10px;
  border-radius: 8px;
  transition: background 0.2s;
}
.help-item:hover { background: #333; }
.help-icon {
  font-size: 2em;
  margin-bottom: 6px;
}
.help-desc {
  text-align: center;
  color: #ddd;
  font-size: 0.9em;
}

/* About section */
#aboutSection {
  margin-top: 15px;
  padding: 12px;
  border-top: 1px solid #333;
  color: #ccc;
  font-size: 0.9em;
  text-align: center;
}
#aboutSection b { color: #1e90ff; }

/* Bookmarks */
.bookmark-item {
  display: flex; align-items: center; margin-bottom: 8px;
  cursor: pointer; background: #333; padding: 5px; border-radius: 5px;
}
.bookmark-item:hover { background: #1e90ff; }
.bookmark-item img { width: 60px; height: 40px; object-fit: cover; margin-right: 8px; border-radius: 3px; }
.bookmark-item span { color: #fff; font-size: 0.95em; }

/* Responsividade */
@media (max-width: 768px) {
  .side-panel { width: 80%; right: -85%; }
  .floating-btn { width: 40px; height: 40px; font-size:1.2em; }
  #btnBookmarks { top: 60px; right: 5px; }
  #btnLayers { top: 120px; }
  #btnLegend { top: 180px; }
  #btnDaylight { top: 240px; }
  #btnMeasurement { top: 300px; }
  #btnElevation { top: 360px; }
}
</style>
</head>

<body>
<div id="viewDiv"></div>

<!-- Header -->
<div id="header">
  <div id="titleBlock">
    <h1>Idaho Falls - High Country</h1>
    <h2>CONCEPT 3_10.16.25</h2>
  </div>
  <div id="btnHelp" title="Help">‚ùî</div>
</div>

<!-- Floating Buttons -->
<div id="btnBookmarks" class="floating-btn" title="Bookmarks">üîñ</div>
<div id="btnLayers" class="floating-btn" title="Layers">üó∫Ô∏è</div>
<div id="btnLegend" class="floating-btn" title="Legend">üìã</div>
<div id="btnDaylight" class="floating-btn" title="Daylight">‚òÄÔ∏è</div>
<div id="btnMeasurement" class="floating-btn" title="3D Measurement">üìè</div>
<div id="btnElevation" class="floating-btn" title="Elevation Profile">‚õ∞Ô∏è</div>

<!-- Panels -->
<div id="bookmarksPanel" class="side-panel"></div>
<div id="layersPanel" class="side-panel"></div>
<div id="legendPanel" class="side-panel"></div>
<div id="daylightPanel" class="side-panel"></div>
<div id="measurementPanel" class="side-panel"></div>
<div id="elevationPanel" class="side-panel"></div>
<div id="helpPanel" class="side-panel">
  <h3>Help Guide</h3>
  <div class="help-item"><div class="help-icon">üîñ</div><div class="help-desc"><b>Bookmarks</b><br>Navigate between pre-defined camera views.</div></div>
  <div class="help-item"><div class="help-icon">üó∫Ô∏è</div><div class="help-desc"><b>Layers</b><br>Show or hide scene layers and manage visibility.</div></div>
  <div class="help-item"><div class="help-icon">üìã</div><div class="help-desc"><b>Legend</b><br>Displays map symbology and meanings.</div></div>
  <div class="help-item"><div class="help-icon">‚òÄÔ∏è</div><div class="help-desc"><b>Daylight</b><br>Adjust sunlight and shadow simulation.</div></div>
  <div class="help-item"><div class="help-icon">üìè</div><div class="help-desc"><b>Measurement</b><br>Measure 3D distances interactively.</div></div>
  <div class="help-item"><div class="help-icon">‚õ∞Ô∏è</div><div class="help-desc"><b>Elevation Profile</b><br>Draw a path to view terrain elevation.</div></div>
  <div id="aboutSection">
    <p><b>GeoBIM Viewer</b><br>
    Version 3.0 ‚Äî Nov 2025<br>
    Developed by <b>Luiz Amadeu Coutinho</b><br>
    ¬© TransformXD</p> <a href="https://transformxd.com/" target="_blank">TransformXD</a>
  </div>
</div>

<script>
require([
  "esri/WebScene","esri/views/SceneView","esri/widgets/LayerList","esri/widgets/Legend",
  "esri/widgets/Daylight","esri/widgets/DirectLineMeasurement3D","esri/widgets/ElevationProfile",
  "esri/widgets/Bookmarks","esri/Graphic","esri/geometry/Polyline"
], function(WebScene, SceneView, LayerList, Legend, Daylight, DirectLineMeasurement3D, ElevationProfile, Bookmarks, Graphic, Polyline){

  const webscene = new WebScene({ portalItem:{id:"d841bada1a9a4a389a083fbc8102068d"} });
  const view = new SceneView({ container:"viewDiv", map:webscene, qualityProfile:"high", environment:{lighting:{directShadowsEnabled:true}} });

  // Widgets
  const layerListWidget = new LayerList({ view });
  const legendWidget = new Legend({ view });
  const daylightWidget = new Daylight({ view });
  const measurementWidget = new DirectLineMeasurement3D({ view });
  const elevationWidget = new ElevationProfile({ view, profiles:[{ type:"ground" }] });
  const bookmarksWidget = new Bookmarks({ view });

  const panels = {
    btnLayers: { panelId:"layersPanel", widget: layerListWidget },
    btnLegend: { panelId:"legendPanel", widget: legendWidget },
    btnDaylight: { panelId:"daylightPanel", widget: daylightWidget },
    btnMeasurement: { panelId:"measurementPanel", widget: measurementWidget },
    btnElevation: { panelId:"elevationPanel", widget: elevationWidget }
  };

  Object.keys(panels).forEach(btnId => {
    const btn = document.getElementById(btnId);
    const panel = document.getElementById(panels[btnId].panelId);
    const widget = panels[btnId].widget;
    widget.container = panel;
    btn.addEventListener("click", ()=>{
      document.querySelectorAll(".side-panel").forEach(p=>{if(p!==panel)p.classList.remove("open");});
      panel.classList.toggle("open");
      if(btnId==="btnElevation") initElevationDraw();
    });
  });

  const bookmarksPanel = document.getElementById("bookmarksPanel");
  document.getElementById("btnBookmarks").addEventListener("click", ()=>{
    document.querySelectorAll(".side-panel").forEach(p=>{if(p!==bookmarksPanel)p.classList.remove("open");});
    bookmarksPanel.classList.toggle("open");
  });

  const helpPanel = document.getElementById("helpPanel");
  document.getElementById("btnHelp").addEventListener("click", ()=>{
    document.querySelectorAll(".side-panel").forEach(p=>{if(p!==helpPanel)p.classList.remove("open");});
    helpPanel.classList.toggle("open");
  });

  webscene.when(()=>{
    if(webscene.presentation?.slides?.length>0){
      webscene.presentation.slides.forEach(slide=>{
        const div = document.createElement("div");
        div.className="bookmark-item";
        const img = document.createElement("img");
        img.src=slide.thumbnail.url;
        const span = document.createElement("span");
        span.textContent=slide.title.text||"Slide";
        div.appendChild(img); div.appendChild(span);
        div.onclick=()=>{ slide.applyTo(view); bookmarksPanel.classList.remove("open"); };
        bookmarksPanel.appendChild(div);
      });
    }
  });

  function initElevationDraw(){
    view.graphics.removeAll();
    let points=[];
    const clickHandler = view.on("click", async event=>{
      const groundPoint = await view.map.ground.queryElevation(event.mapPoint);
      points.push([groundPoint.x, groundPoint.y, groundPoint.z]);
      if(points.length>1){
        const polyline = new Polyline({ paths:[points], spatialReference:view.spatialReference });
        view.graphics.removeAll();
        view.graphics.add(new Graphic({ geometry: polyline, symbol:{ type:"simple-line", color:[0,150,255], width:3 } }));
        elevationWidget.input = new Graphic({ geometry: polyline });
      }
    });

    const observer = new MutationObserver(()=>{
      if(!document.getElementById("elevationPanel").classList.contains("open")){
        clickHandler.remove(); observer.disconnect();
      }
    });
    observer.observe(document.getElementById("elevationPanel"), { attributes:true, attributeFilter:["class"] });
  }
});
</script>
</body>
</html>
